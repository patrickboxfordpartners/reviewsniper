<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Review Sniper</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 40 40'><rect width='40' height='40' rx='8' fill='%232563EB'/><circle cx='20' cy='20' r='12' stroke='white' stroke-width='3'/><circle cx='20' cy='20' r='5' fill='white'/></svg>">

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@auth0/auth0-spa-js@2.1.3/dist/auth0-spa-js.production.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F8FAFC; }
        .sidebar-link { display: flex; align-items: center; gap: 12px; padding: 12px 16px; border-radius: 8px; color: #64748B; font-weight: 500; transition: all 0.2s; }
        .sidebar-link:hover { background-color: #F1F5F9; color: #0F172A; }
        .sidebar-link.active { background-color: #EFF6FF; color: #2563EB; }
        .card { background: white; border-radius: 12px; border: 1px solid #E2E8F0; padding: 24px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- AUTH CONFIG ---
        const auth0Config = {
            domain: "dev-spfyirobhkaeiat2.us.auth0.com",
            clientId: "1HhJcq0gBYolhWDoujobABROk0ZJ47fs",
            authorizationParams: { redirect_uri: window.location.href }
        };

        // --- MOCK DATA ---
        const MOCK_FEEDBACK = [
            { id: 1, name: "John D.", rating: 2, message: "Service was slow and the waiting room was dirty.", date: "2 hours ago", status: "New" },
            { id: 2, name: "Sarah M.", rating: 3, message: "Staff was friendly but the price was higher than quoted.", date: "1 day ago", status: "Read" },
            { id: 3, name: "Mike T.", rating: 1, message: "Nobody called me back. Very frustrated.", date: "2 days ago", status: "Replied" },
        ];

        // --- COMPONENTS ---
        const Sidebar = ({ currentTab, setTab, user, logout }) => (
            <div className="fixed left-0 top-0 h-full w-64 bg-white border-r border-slate-200 flex flex-col z-50">
                <div className="p-6 flex items-center gap-3 border-b border-slate-100">
                    <div className="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white">
                        <i className="fa-solid fa-crosshairs"></i>
                    </div>
                    <span className="font-bold text-xl text-slate-900">ReviewSniper</span>
                </div>
                
                <nav className="flex-1 p-4 space-y-1">
                    <button onClick={() => setTab('dashboard')} className={`sidebar-link w-full ${currentTab === 'dashboard' ? 'active' : ''}`}>
                        <i className="fa-solid fa-gauge-high w-5"></i> Dashboard
                    </button>
                    <button onClick={() => setTab('send')} className={`sidebar-link w-full ${currentTab === 'send' ? 'active' : ''}`}>
                        <i className="fa-solid fa-paper-plane w-5"></i> Send Requests
                    </button>
                    <button onClick={() => setTab('qr')} className={`sidebar-link w-full ${currentTab === 'qr' ? 'active' : ''}`}>
                        <i className="fa-solid fa-qrcode w-5"></i> QR Code
                    </button>
                    <button onClick={() => setTab('inbox')} className={`sidebar-link w-full ${currentTab === 'inbox' ? 'active' : ''}`}>
                        <i className="fa-solid fa-inbox w-5"></i> 
                        <span>Intercepted</span>
                        <span className="ml-auto bg-red-100 text-red-600 text-xs font-bold px-2 py-0.5 rounded-full">3</span>
                    </button>
                </nav>

                <div className="p-4 border-t border-slate-100">
                    <div className="flex items-center gap-3 mb-3">
                        <img src={user?.picture} className="w-9 h-9 rounded-full border border-slate-200" />
                        <div className="overflow-hidden">
                            <p className="text-sm font-bold text-slate-900 truncate">{user?.name}</p>
                            <p className="text-xs text-slate-500 truncate">{user?.email}</p>
                        </div>
                    </div>
                    <button onClick={() => logout({ logoutParams: { returnTo: window.location.origin } })} className="text-xs font-medium text-red-500 hover:text-red-700 w-full text-left pl-1">
                        Sign Out
                    </button>
                </div>
            </div>
        );

        // --- VIEWS ---
        const DashboardView = () => (
            <div className="space-y-6">
                <header>
                    <h1 className="text-2xl font-bold text-slate-900">Overview</h1>
                    <p className="text-slate-500">Your reputation funnel performance.</p>
                </header>
                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div className="card border-l-4 border-l-green-500">
                        <p className="text-sm font-medium text-slate-500 mb-1">Reviews Pushed to Google</p>
                        <div className="flex items-end gap-2">
                            <h3 className="text-3xl font-bold text-slate-900">142</h3>
                            <span className="text-xs font-medium text-green-600 mb-1"><i className="fa-solid fa-arrow-up"></i> 4-5 Star</span>
                        </div>
                    </div>
                    <div className="card border-l-4 border-l-amber-500">
                        <p className="text-sm font-medium text-slate-500 mb-1">Intercepted Feedback</p>
                        <div className="flex items-end gap-2">
                            <h3 className="text-3xl font-bold text-slate-900">18</h3>
                            <span className="text-xs font-medium text-amber-600 mb-1"><i className="fa-solid fa-shield-halved"></i> 1-3 Star Saved</span>
                        </div>
                    </div>
                    <div className="card border-l-4 border-l-blue-500">
                        <p className="text-sm font-medium text-slate-500 mb-1">Conversion Rate</p>
                        <div className="flex items-end gap-2">
                            <h3 className="text-3xl font-bold text-slate-900">24%</h3>
                            <span className="text-xs font-medium text-slate-400 mb-1">Request to Review</span>
                        </div>
                    </div>
                </div>
                
                <div className="card">
                    <h3 className="font-bold text-slate-900 mb-6">Live Feed</h3>
                    <div className="space-y-6">
                        <div className="flex gap-4 relative">
                            <div className="w-0.5 bg-slate-200 absolute top-8 bottom-0 left-4"></div>
                            <div className="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center text-green-600 shrink-0 z-10"><i className="fa-brands fa-google"></i></div>
                            <div>
                                <p className="text-sm text-slate-900"><span className="font-bold">Sarah M.</span> clicked 5 stars.</p>
                                <p className="text-xs text-green-600 font-medium mt-1">Redirected to Google Maps</p>
                                <p className="text-xs text-slate-400 mt-1">2 minutes ago</p>
                            </div>
                        </div>
                        <div className="flex gap-4 relative">
                            <div className="w-0.5 bg-slate-200 absolute top-8 bottom-0 left-4"></div>
                            <div className="w-8 h-8 rounded-full bg-amber-100 flex items-center justify-center text-amber-600 shrink-0 z-10"><i className="fa-solid fa-triangle-exclamation"></i></div>
                            <div>
                                <p className="text-sm text-slate-900"><span className="font-bold">John D.</span> clicked 2 stars.</p>
                                <p className="text-xs text-amber-600 font-medium mt-1">Diverted to Private Feedback Form</p>
                                <p className="text-xs text-slate-400 mt-1">1 hour ago</p>
                            </div>
                        </div>
                         <div className="flex gap-4">
                            <div className="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 shrink-0 z-10"><i className="fa-solid fa-paper-plane"></i></div>
                            <div>
                                <p className="text-sm text-slate-900">Bulk SMS Campaign Sent</p>
                                <p className="text-xs text-slate-500 mt-1">45 recipients</p>
                                <p className="text-xs text-slate-400 mt-1">4 hours ago</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        );

        const SendView = () => {
            const [loading, setLoading] = useState(false);
            const [sent, setSent] = useState(false);
            const handleSubmit = (e) => {
                e.preventDefault();
                setLoading(true);
                setTimeout(() => { setLoading(false); setSent(true); setTimeout(() => setSent(false), 3000); }, 1500);
            };
            return (
                <div className="max-w-lg mx-auto mt-10">
                    <div className="card">
                        <div className="text-center mb-6">
                            <div className="w-12 h-12 bg-blue-50 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-4 text-xl"><i className="fa-solid fa-paper-plane"></i></div>
                            <h2 className="text-xl font-bold text-slate-900">Send Review Request</h2>
                            <p className="text-sm text-slate-500">Send a text to a recent customer.</p>
                        </div>
                        {sent ? (
                            <div className="bg-green-50 text-green-700 p-4 rounded-lg text-center animate-bounce">
                                <i className="fa-solid fa-check-circle mr-2"></i> Sent successfully!
                            </div>
                        ) : (
                            <form onSubmit={handleSubmit} className="space-y-4">
                                <div><label className="block text-sm font-medium text-slate-700 mb-1">Customer Name</label><input required type="text" className="w-full p-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" placeholder="Jane Doe" /></div>
                                <div><label className="block text-sm font-medium text-slate-700 mb-1">Phone Number</label><input required type="tel" className="w-full p-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" placeholder="(555) 000-0000" /></div>
                                <button disabled={loading} className="w-full bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition-colors">{loading ? <i className="fa-solid fa-circle-notch fa-spin"></i> : "Send Request"}</button>
                            </form>
                        )}
                    </div>
                </div>
            );
        };

        const QRView = () => {
            const qrRef = useRef(null);
            useEffect(() => {
                if (qrRef.current) {
                    qrRef.current.innerHTML = "";
                    new QRCode(qrRef.current, { text: "https://reviewsniper.app/review/your-business-id", width: 200, height: 200 });
                }
            }, []);
            return (
                <div className="max-w-lg mx-auto mt-10 text-center">
                    <div className="card">
                        <h2 className="text-xl font-bold text-slate-900 mb-2">Your Review QR Code</h2>
                        <p className="text-sm text-slate-500 mb-8">Print this and place it at your checkout counter.</p>
                        <div className="flex justify-center mb-8"><div className="p-4 bg-white border-2 border-slate-100 rounded-xl shadow-sm" ref={qrRef}></div></div>
                        <div className="flex gap-3 justify-center">
                            <button className="px-4 py-2 bg-slate-900 text-white text-sm font-bold rounded-lg hover:bg-slate-800"><i className="fa-solid fa-download mr-2"></i> Download PDF</button>
                        </div>
                    </div>
                </div>
            );
        };

        const InboxView = () => (
            <div className="space-y-6">
                <header><h1 className="text-2xl font-bold text-slate-900">Intercepted Feedback</h1><p className="text-slate-500">Negative reviews caught before they went public.</p></header>
                <div className="grid gap-4">
                    {MOCK_FEEDBACK.map((item) => (
                        <div key={item.id} className="card hover:border-blue-300 transition-colors cursor-pointer group">
                            <div className="flex justify-between items-start mb-3">
                                <div className="flex items-center gap-3">
                                    <div className="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center font-bold text-slate-600">{item.name.charAt(0)}</div>
                                    <div><h4 className="font-bold text-slate-900">{item.name}</h4><div className="flex text-yellow-400 text-xs">{[...Array(5)].map((_, i) => (<i key={i} className={`fa-star ${i < item.rating ? "fa-solid" : "fa-regular text-slate-300"}`}></i>))}</div></div>
                                </div>
                                <span className={`text-xs font-bold px-2 py-1 rounded-full ${item.status === 'New' ? 'bg-red-100 text-red-600' : 'bg-slate-100 text-slate-500'}`}>{item.status}</span>
                            </div>
                            <p className="text-slate-600 text-sm mb-4 bg-slate-50 p-3 rounded-lg">"{item.message}"</p>
                            <div className="flex justify-between items-center"><span className="text-xs text-slate-400">{item.date}</span><button className="text-sm text-blue-600 font-bold hover:underline opacity-0 group-hover:opacity-100 transition-opacity">Reply Privately <i className="fa-solid fa-arrow-right ml-1"></i></button></div>
                        </div>
                    ))}
                </div>
            </div>
        );

        // --- MAIN APP ---
        const App = () => {
            const [auth0Client, setAuth0] = useState(null);
            const [isLoading, setIsLoading] = useState(true);
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [user, setUser] = useState(null);
            const [activeTab, setActiveTab] = useState('dashboard');

            useEffect(() => {
                const initAuth = async () => {
                    try {
                        const client = await auth0.createAuth0Client(auth0Config);
                        setAuth0(client);
                        if (window.location.search.includes("code=")) {
                            await client.handleRedirectCallback();
                            window.history.replaceState({}, document.title, window.location.pathname);
                        }
                        const isAuth = await client.isAuthenticated();
                        setIsAuthenticated(isAuth);
                        if (isAuth) setUser(await client.getUser());
                        else await client.loginWithRedirect();
                    } catch (err) { console.error(err); } finally { setIsLoading(false); }
                };
                initAuth();
            }, []);

            if (isLoading) return <div className="h-screen flex items-center justify-center bg-slate-50"><div className="w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"></div></div>;
            if (!isAuthenticated) return null;

            return (
                <div className="min-h-screen flex">
                    <Sidebar currentTab={activeTab} setTab={setActiveTab} user={user} logout={auth0Client?.logout} />
                    <main className="flex-1 ml-64 p-8">
                        {activeTab === 'dashboard' && <DashboardView />}
                        {activeTab === 'send' && <SendView />}
                        {activeTab === 'qr' && <QRView />}
                        {activeTab === 'inbox' && <InboxView />}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
