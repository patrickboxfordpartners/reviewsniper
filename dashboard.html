<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Review Sniper</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 40 40'><rect width='40' height='40' rx='8' fill='%232563EB'/><circle cx='20' cy='20' r='12' stroke='white' stroke-width='3'/><circle cx='20' cy='20' r='5' fill='white'/></svg>">

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@auth0/auth0-spa-js@2.1.3/dist/auth0-spa-js.production.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F8FAFC; }
        .sidebar-link { display: flex; align-items: center; gap: 12px; padding: 12px 16px; border-radius: 8px; color: #64748B; font-weight: 500; transition: all 0.2s; cursor: pointer; }
        .sidebar-link:hover { background-color: #F1F5F9; color: #0F172A; }
        .sidebar-link.active { background-color: #EFF6FF; color: #2563EB; }
        .card { background: white; border-radius: 12px; border: 1px solid #E2E8F0; padding: 24px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- AUTH CONFIG ---
        const auth0Config = {
            domain: "dev-spfyirobhkaeiat2.us.auth0.com",
            clientId: "1HhJcq0gBYolhWDoujobABROk0ZJ47fs",
            authorizationParams: { redirect_uri: window.location.href }
        };

        // --- MOCK DATA ---
        const INTERCEPTED_FEEDBACK = [
            { id: 1, name: "Mike Ross", rating: 2, feedback: "Wait time was insane. 45 minutes for a simple cut.", date: "2 hours ago", status: "New" },
            { id: 2, name: "Harvey S.", rating: 3, feedback: "Good service but way too expensive for what it is.", date: "1 day ago", status: "Read" },
            { id: 3, name: "Louis L.", rating: 1, feedback: "Nobody greeted me. I walked out.", date: "2 days ago", status: "Replied" },
        ];

        // --- COMPONENTS ---
        
        const Sidebar = ({ currentTab, setTab, user, logout }) => (
            <div className="fixed left-0 top-0 h-full w-64 bg-white border-r border-slate-200 flex flex-col z-50">
                <div className="p-6 flex items-center gap-3 border-b border-slate-100">
                    <div className="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white">
                        <i className="fa-solid fa-crosshairs"></i>
                    </div>
                    <span className="font-bold text-xl text-slate-900">ReviewSniper</span>
                </div>
                
                <nav className="flex-1 p-4 space-y-1">
                    <div onClick={() => setTab('dashboard')} className={`sidebar-link w-full ${currentTab === 'dashboard' ? 'active' : ''}`}>
                        <i className="fa-solid fa-chart-line w-5"></i> Overview
                    </div>
                    <div onClick={() => setTab('inbox')} className={`sidebar-link w-full ${currentTab === 'inbox' ? 'active' : ''}`}>
                        <i className="fa-solid fa-inbox w-5"></i> 
                        <span>Intercepted</span>
                        <span className="ml-auto bg-red-100 text-red-600 text-xs font-bold px-2 py-0.5 rounded-full">3</span>
                    </div>
                    <div onClick={() => setTab('qr')} className={`sidebar-link w-full ${currentTab === 'qr' ? 'active' : ''}`}>
                        <i className="fa-solid fa-qrcode w-5"></i> Get QR Code
                    </div>
                    <div onClick={() => setTab('send')} className={`sidebar-link w-full ${currentTab === 'send' ? 'active' : ''}`}>
                        <i className="fa-solid fa-paper-plane w-5"></i> Send Request
                    </div>
                </nav>

                <div className="p-4 border-t border-slate-100">
                    <div className="flex items-center gap-3 mb-3">
                        <img src={user?.picture} className="w-9 h-9 rounded-full border border-slate-200" />
                        <div className="overflow-hidden">
                            <p className="text-sm font-bold text-slate-900 truncate">{user?.name}</p>
                            <p className="text-xs text-slate-500 truncate">{user?.email}</p>
                        </div>
                    </div>
                    <button onClick={() => logout({ logoutParams: { returnTo: window.location.origin } })} className="text-xs font-medium text-red-500 hover:text-red-700 w-full text-left pl-1">
                        Sign Out
                    </button>
                </div>
            </div>
        );

        const DashboardView = () => (
            <div className="space-y-6">
                <header>
                    <h1 className="text-2xl font-bold text-slate-900">Gatekeeper Performance</h1>
                    <p className="text-slate-500">Real-time reputation filtering.</p>
                </header>

                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div className="card border-l-4 border-l-green-500">
                        <div className="flex justify-between items-start">
                            <div>
                                <p className="text-sm font-medium text-slate-500 mb-1">Pushed to Google</p>
                                <h3 className="text-3xl font-bold text-slate-900">142</h3>
                            </div>
                            <div className="p-2 bg-green-50 rounded-lg text-green-600"><i className="fa-brands fa-google text-xl"></i></div>
                        </div>
                        <div className="mt-4 text-xs font-medium text-green-600">
                            <i className="fa-solid fa-arrow-up"></i> 4 & 5 Star Reviews
                        </div>
                    </div>

                    <div className="card border-l-4 border-l-red-500">
                        <div className="flex justify-between items-start">
                            <div>
                                <p className="text-sm font-medium text-slate-500 mb-1">Intercepted</p>
                                <h3 className="text-3xl font-bold text-slate-900">18</h3>
                            </div>
                            <div className="p-2 bg-red-50 rounded-lg text-red-600"><i className="fa-solid fa-shield-halved text-xl"></i></div>
                        </div>
                        <div className="mt-4 text-xs font-medium text-slate-500">
                            Saved from public view (1-3 Stars)
                        </div>
                    </div>

                    <div className="card border-l-4 border-l-blue-500">
                        <div className="flex justify-between items-start">
                            <div>
                                <p className="text-sm font-medium text-slate-500 mb-1">Total Requests</p>
                                <h3 className="text-3xl font-bold text-slate-900">385</h3>
                            </div>
                            <div className="p-2 bg-blue-50 rounded-lg text-blue-600"><i className="fa-solid fa-paper-plane text-xl"></i></div>
                        </div>
                        <div className="mt-4 text-xs font-medium text-blue-600">
                            42% Response Rate
                        </div>
                    </div>
                </div>
            </div>
        );

        const InboxView = () => (
            <div className="space-y-6">
                <header>
                    <h1 className="text-2xl font-bold text-slate-900">Intercepted Feedback</h1>
                    <p className="text-slate-500">Negative feedback caught by the Gatekeeper.</p>
                </header>
                <div className="grid gap-4">
                    {INTERCEPTED_FEEDBACK.map((item) => (
                        <div key={item.id} className="card hover:border-blue-300 transition-colors cursor-pointer group border-l-4 border-l-red-400">
                            <div className="flex justify-between items-start mb-3">
                                <div className="flex items-center gap-3">
                                    <div className="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center font-bold text-slate-600">
                                        {item.name.charAt(0)}
                                    </div>
                                    <div>
                                        <h4 className="font-bold text-slate-900">{item.name}</h4>
                                        <div className="flex text-yellow-400 text-xs">
                                            {[...Array(5)].map((_, i) => (
                                                <i key={i} className={`fa-star ${i < item.rating ? "fa-solid" : "fa-regular text-slate-300"}`}></i>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                                <span className={`text-xs font-bold px-2 py-1 rounded-full ${item.status === 'New' ? 'bg-red-100 text-red-600' : 'bg-slate-100 text-slate-500'}`}>{item.status}</span>
                            </div>
                            <div className="bg-slate-50 p-3 rounded-lg mb-4">
                                <p className="text-slate-700 text-sm italic">"{item.feedback}"</p>
                            </div>
                            <div className="flex justify-between items-center pt-2 border-t border-slate-100">
                                <span className="text-xs text-slate-400">{item.date}</span>
                                <button className="text-sm bg-white border border-slate-200 px-3 py-1.5 rounded-md font-semibold text-slate-600 hover:bg-slate-50 hover:text-blue-600 transition-colors">
                                    <i className="fa-solid fa-reply mr-2"></i> Reply Privately
                                </button>
                            </div>
                        </div>
                    ))}
                </div>
            </div>
        );

        const QRView = () => {
            const qrRef = useRef(null);
            // Points to the Feedback Funnel Page
            const feedbackUrl = window.location.origin + "/feedback.html";

            useEffect(() => {
                if (qrRef.current) {
                    qrRef.current.innerHTML = "";
                    new QRCode(qrRef.current, {
                        text: feedbackUrl,
                        width: 200,
                        height: 200
                    });
                }
            }, []);

            return (
                <div className="max-w-lg mx-auto mt-10 text-center">
                    <div className="card">
                        <h2 className="text-xl font-bold text-slate-900 mb-2">Your Review QR Code</h2>
                        <p className="text-sm text-slate-500 mb-8">Directs customers to your Gatekeeper funnel.</p>
                        <div className="flex justify-center mb-8">
                            <div className="p-4 bg-white border-2 border-slate-100 rounded-xl shadow-sm" ref={qrRef}></div>
                        </div>
                        <div className="bg-slate-50 p-3 rounded-lg text-sm text-slate-500 break-all mb-6">
                            {feedbackUrl}
                        </div>
                        <button onClick={() => window.open(feedbackUrl, '_blank')} className="px-4 py-2 bg-slate-900 text-white text-sm font-bold rounded-lg hover:bg-slate-800">
                            Test It Yourself <i className="fa-solid fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [auth0Client, setAuth0] = useState(null);
            const [isLoading, setIsLoading] = useState(true);
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [user, setUser] = useState(null);
            const [activeTab, setActiveTab] = useState('dashboard');

            useEffect(() => {
                const initAuth = async () => {
                    try {
                        const client = await auth0.createAuth0Client(auth0Config);
                        setAuth0(client);
                        if (window.location.search.includes("code=")) {
                            await client.handleRedirectCallback();
                            window.history.replaceState({}, document.title, window.location.pathname);
                        }
                        const isAuth = await client.isAuthenticated();
                        setIsAuthenticated(isAuth);
                        if (isAuth) setUser(await client.getUser());
                        else await client.loginWithRedirect();
                    } catch (err) { console.error(err); } finally { setIsLoading(false); }
                };
                initAuth();
            }, []);

            if (isLoading) return <div className="h-screen flex items-center justify-center bg-slate-50"><div className="w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"></div></div>;
            if (!isAuthenticated) return null;

            return (
                <div className="min-h-screen flex">
                    <Sidebar currentTab={activeTab} setTab={setActiveTab} user={user} logout={auth0Client?.logout} />
                    <main className="flex-1 ml-64 p-8">
                        {activeTab === 'dashboard' && <DashboardView />}
                        {activeTab === 'inbox' && <InboxView />}
                        {activeTab === 'qr' && <QRView />}
                        {activeTab === 'send' && <div className="text-center mt-20 text-slate-400">Send Request Module (Coming Soon)</div>}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
