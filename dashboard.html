<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Review Sniper</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 40 40'><rect width='40' height='40' rx='8' fill='%232563EB'/><circle cx='20' cy='20' r='12' stroke='white' stroke-width='3'/><circle cx='20' cy='20' r='5' fill='white'/></svg>">

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@auth0/auth0-spa-js@2.1.3/dist/auth0-spa-js.production.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F1F5F9; }
        .sidebar-link { display: flex; align-items: center; gap: 12px; padding: 12px 16px; border-radius: 8px; color: #64748B; font-weight: 600; transition: all 0.2s; }
        .sidebar-link:hover { background-color: #F8FAFC; color: #0F172A; }
        .sidebar-link.active { background-color: #EFF6FF; color: #2563EB; }
        .card { background: white; border-radius: 12px; border: 1px solid #E2E8F0; padding: 24px; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1); }
        .btn-primary { background-color: #2563EB; color: white; font-weight: 600; border-radius: 8px; padding: 10px 20px; transition: background 0.2s; }
        .btn-primary:hover { background-color: #1D4ED8; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- AUTH SETUP ---
        const auth0Config = {
            domain: "dev-spfyirobhkaeiat2.us.auth0.com",
            clientId: "1HhJcq0gBYolhWDoujobABROk0ZJ47fs",
            authorizationParams: { redirect_uri: window.location.href }
        };

        // --- COMPONENTS ---

        // 1. Sidebar Navigation
        const Sidebar = ({ currentTab, setTab, user, logout }) => (
            <div className="fixed left-0 top-0 h-full w-64 bg-white border-r border-slate-200 flex flex-col z-10">
                <div className="p-6 flex items-center gap-3 border-b border-slate-100">
                    <div className="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white">
                        <i className="fa-solid fa-crosshairs"></i>
                    </div>
                    <span className="font-bold text-xl text-slate-900 tracking-tight">ReviewSniper</span>
                </div>
                
                <nav className="flex-1 p-4 space-y-1">
                    <button onClick={() => setTab('home')} className={`sidebar-link w-full ${currentTab === 'home' ? 'active' : ''}`}>
                        <i className="fa-solid fa-gauge-high w-5"></i> Dashboard
                    </button>
                    <button onClick={() => setTab('send')} className={`sidebar-link w-full ${currentTab === 'send' ? 'active' : ''}`}>
                        <i className="fa-solid fa-paper-plane w-5"></i> Send Request
                    </button>
                    <button onClick={() => setTab('reviews')} className={`sidebar-link w-full ${currentTab === 'reviews' ? 'active' : ''}`}>
                        <i className="fa-solid fa-star w-5"></i> All Reviews
                    </button>
                    <button onClick={() => setTab('settings')} className={`sidebar-link w-full ${currentTab === 'settings' ? 'active' : ''}`}>
                        <i className="fa-solid fa-sliders w-5"></i> Settings
                    </button>
                </nav>

                <div className="p-4 border-t border-slate-100">
                    <div className="flex items-center gap-3 mb-3">
                        <img src={user?.picture} className="w-9 h-9 rounded-full border border-slate-200" />
                        <div className="overflow-hidden">
                            <p className="text-sm font-bold text-slate-900 truncate">{user?.name}</p>
                            <p className="text-xs text-slate-500 truncate">{user?.email}</p>
                        </div>
                    </div>
                    <button onClick={() => logout({ logoutParams: { returnTo: window.location.origin } })} className="text-xs font-medium text-red-500 hover:text-red-700 w-full text-left pl-1">
                        Sign Out
                    </button>
                </div>
            </div>
        );

        // 2. Home/Dashboard Tab
        const HomeTab = () => (
            <div className="space-y-6">
                <header>
                    <h1 className="text-2xl font-bold text-slate-900">Overview</h1>
                    <p className="text-slate-500">Your reputation performance for the last 30 days.</p>
                </header>

                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div className="card">
                        <p className="text-sm font-medium text-slate-500 mb-1">Total Reviews</p>
                        <div className="flex items-end justify-between">
                            <h3 className="text-3xl font-bold text-slate-900">142</h3>
                            <span className="text-xs font-bold text-green-600 bg-green-50 px-2 py-1 rounded-full">+12%</span>
                        </div>
                    </div>
                    <div className="card">
                        <p className="text-sm font-medium text-slate-500 mb-1">Average Rating</p>
                        <div className="flex items-end justify-between">
                            <h3 className="text-3xl font-bold text-slate-900">4.9</h3>
                            <div className="flex text-yellow-400 text-sm mb-1">
                                <i className="fa-solid fa-star"></i><i className="fa-solid fa-star"></i><i className="fa-solid fa-star"></i><i className="fa-solid fa-star"></i><i className="fa-solid fa-star-half-stroke"></i>
                            </div>
                        </div>
                    </div>
                    <div className="card">
                        <p className="text-sm font-medium text-slate-500 mb-1">Requests Sent</p>
                        <div className="flex items-end justify-between">
                            <h3 className="text-3xl font-bold text-slate-900">85</h3>
                            <span className="text-xs font-medium text-slate-400">This month</span>
                        </div>
                    </div>
                </div>

                <div className="card">
                    <h3 className="font-bold text-slate-900 mb-4">Recent Activity</h3>
                    <div className="space-y-4">
                        {[
                            { name: "Sarah Connor", action: "left a 5-star review on Google", time: "2h ago", icon: "fa-google" },
                            { name: "Kyle Reese", action: "clicked review link", time: "5h ago", icon: "fa-link" },
                            { name: "T-800", action: "received SMS request", time: "1d ago", icon: "fa-comment-sms" },
                        ].map((item, i) => (
                            <div key={i} className="flex items-center justify-between py-2 border-b border-slate-50 last:border-0">
                                <div className="flex items-center gap-3">
                                    <div className="w-8 h-8 bg-slate-100 rounded-full flex items-center justify-center text-slate-500 text-xs">
                                        <i className={`fa-brands ${item.icon} text-sm`}></i>
                                    </div>
                                    <div>
                                        <p className="text-sm font-medium text-slate-900">{item.name}</p>
                                        <p className="text-xs text-slate-500">{item.action}</p>
                                    </div>
                                </div>
                                <span className="text-xs text-slate-400">{item.time}</span>
                            </div>
                        ))}
                    </div>
                </div>
            </div>
        );

        // 3. Send Request Tab
        const SendTab = () => {
            const [status, setStatus] = useState('idle'); // idle, sending, success

            const handleSubmit = (e) => {
                e.preventDefault();
                setStatus('sending');
                // Simulate API delay
                setTimeout(() => {
                    setStatus('success');
                    setTimeout(() => setStatus('idle'), 3000);
                }, 1500);
            };

            return (
                <div className="max-w-md mx-auto mt-12">
                    <div className="card">
                        <div className="text-center mb-6">
                            <div className="w-12 h-12 bg-blue-50 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i className="fa-solid fa-paper-plane text-xl"></i>
                            </div>
                            <h2 className="text-xl font-bold text-slate-900">Send Review Request</h2>
                            <p className="text-sm text-slate-500">Enter customer details to send an SMS.</p>
                        </div>

                        {status === 'success' ? (
                            <div className="bg-green-50 text-green-700 p-4 rounded-lg text-center animate-bounce">
                                <i className="fa-solid fa-check-circle mr-2"></i> Request Sent Successfully!
                            </div>
                        ) : (
                            <form onSubmit={handleSubmit} className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium text-slate-700 mb-1">Customer Name</label>
                                    <input required type="text" className="w-full border border-slate-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500 outline-none" placeholder="John Doe" />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-slate-700 mb-1">Phone Number</label>
                                    <input required type="tel" className="w-full border border-slate-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500 outline-none" placeholder="(555) 000-0000" />
                                </div>
                                <button disabled={status === 'sending'} className="btn-primary w-full py-3 flex justify-center items-center gap-2">
                                    {status === 'sending' ? <i className="fa-solid fa-circle-notch fa-spin"></i> : 'Send Request'}
                                </button>
                            </form>
                        )}
                    </div>
                </div>
            );
        };

        // --- MAIN APP ---
        const App = () => {
            const [auth0Client, setAuth0] = useState(null);
            const [isLoading, setIsLoading] = useState(true);
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [user, setUser] = useState(null);
            const [activeTab, setActiveTab] = useState('home');

            useEffect(() => {
                const initAuth = async () => {
                    try {
                        const client = await auth0.createAuth0Client(auth0Config);
                        setAuth0(client);

                        if (window.location.search.includes("code=")) {
                            await client.handleRedirectCallback();
                            window.history.replaceState({}, document.title, window.location.pathname);
                        }

                        const isAuth = await client.isAuthenticated();
                        setIsAuthenticated(isAuth);
                        
                        if (isAuth) {
                            setUser(await client.getUser());
                        } else {
                            // Force login if trying to access dashboard directly
                            await client.loginWithRedirect();
                        }
                    } catch (err) {
                        console.error(err);
                    } finally {
                        setIsLoading(false);
                    }
                };
                initAuth();
            }, []);

            if (isLoading) return (
                <div className="h-screen flex items-center justify-center">
                    <div className="w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"></div>
                </div>
            );

            if (!isAuthenticated) return null;

            return (
                <div className="min-h-screen flex">
                    <Sidebar currentTab={activeTab} setTab={setActiveTab} user={user} logout={auth0Client.logout} />
                    <main className="flex-1 ml-64 p-8">
                        {activeTab === 'home' && <HomeTab />}
                        {activeTab === 'send' && <SendTab />}
                        {activeTab === 'reviews' && <div className="text-center text-slate-400 mt-20"><i className="fa-solid fa-person-digging text-4xl mb-4"></i><p>Reviews List Module Coming Soon</p></div>}
                        {activeTab === 'settings' && <div className="text-center text-slate-400 mt-20"><i className="fa-solid fa-wrench text-4xl mb-4"></i><p>Account Settings Module Coming Soon</p></div>}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
